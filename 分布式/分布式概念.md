
## CAP 定理指出，分布式系统 不可能 同时提供下面三个要求：
![cp](CAP.JPG)
* Consistency：一致性 ,操作更新完成并返回客户端之后，所有节点数据完全一致；比如主从集群的MYSQL;
* Availability：可用性， 每次请求都能在合理时间内获得响应（即使是非故障节点返回陈旧数据或者节点故障‌，如服务器宕机）；系统不会因部分故障而中断服务‌；
* Partition tolerance：分区容错性，分布式系统在遇到网络分区故障的时候（节点间通信中断）时仍能继续运行‌
  ），仍然能够对外提供满足一致性和可用性的服务

总结：区别 A、P；可用性是针对节点出现故障，系统可用；分区容错性是针对网络出现问题，系统可用.比如
可用性是针对非故障节点，如主mysql节点挂了，但从mysql没有挂，而且从mysql照样提供服务，就说明此分布式系统具有可用性。
分区容错性是各个节点出现网络问题时，系统依然可用。如主Mysql和从Mysql 之间没法通信时，系统可用。


## 为什么不能同时提供C、A、P
在分布式系统中，网络出问题是常态，所以必须支持分区容错（P）。
根本矛盾‌：
网络分区发生时（如节点间通信中断），系统必须优先保证分区容错性；此时，如果选择‌一致性‌，系统会拒绝不一致数据的访问或写入，导致部分请求失败（牺牲可用性）。‌
如果选择‌可用性‌，系统允许读取或写入数据，但可能出现节点间数据不一致（牺牲一致性）
这就意味着，只能在一致性（C）和可用性（A）之间做取舍，不能三者都要。


## 常用的分布式系统的权衡：
1. Redis中间件 ----> AP
2. RocketMQ中间件 -----> AP
3. 分布式事务-2pc ----> CP
4. 分布式事务-最大努力尝试 ---> AP
5. Eureka ---> AP

## Mysql是属于什么？
单机部署的MySQL‌属于CA系统（一致性和可用性）;
分布式场景下的MySQL‌通过不同复制模式实现不同权衡
 * 异步复制/‌半同步复制‌：默认模式，属于AP模型（优先保证可用性），主库不等待从库同步即响应客户端，性能最高但可能丢失数据
 * 强同步复制:属于CP模型（优先保证一致性），主库必须等待所有从库完成数据同步才响应，确保强一致性但牺牲可用性


## 服务发现机制的AP/CP权衡




## 参考材料
* 分布式系统的 38 个知识点
https://my.oschina.net/u/566591/blog/5563844

* 分布式
    * [大白话讲解“什么是CAP定理](https://zhuanlan.zhihu.com/p/21847363802)
    * https://developer.aliyun.com/article/1671238